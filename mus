#!/bin/sh
# shellcheck disable=1090,2154

. "$HOME/.cache/wal/colors.sh"
blockcolor=$color8
txtcolor=$color7

case $BLOCK_BUTTON in
    1)
        playerctl previous
        ;;
    2)
        playerctl play-pause
        ;;
    3)
        playerctl next
        ;;
    4)
        playerctl position 5+
        ;;
    5)
        playerctl position 5-
        ;;
esac

if ! playerctl metadata >/dev/null; then
    exit
elif [ "$(playerctl -p mpd status)" = "Playing" ]; then
    artist="$(playerctl -p mpd metadata artist)"
    title="$(playerctl -p mpd metadata title)"
elif [ "$(playerctl -p spotify status)" = "Playing" ]; then
    artist="$(playerctl -p spotify metadata artist)"
    title="$(playerctl -p spotify metadata title)"
elif [ "$(playerctl -p mpv status)" = "Playing" ]; then
    artist="$(playerctl -p mpv metadata artist)"
    title="$(playerctl -p mpv metadata title)"
else
    artist="$(playerctl metadata artist)"
    title="$(playerctl metadata title)"
fi

# i3blocks doesn't seem to like ampersands
if echo "$artist" | grep -q '&';then
    artist=$(echo "$title" | sed 's/&/and/')
elif echo "$title" | grep -q '&';then
    title=$(echo "$title" | sed 's/&/and/')
fi

if [ -z "$artist" ]; then
    icon= 
    # icon=VID
    printf "\
<span foreground='$blockcolor' background='$color0'></span>\
<span foreground='$txtcolor' background='$blockcolor'> %s </span>\
<span foreground='$color0' background='$blockcolor'></span>\n" \
"$icon $title"
else
    icon=
    # icon=MUS
    printf "\
<span foreground='$blockcolor' background='$color0'></span>\
<span foreground='$color3' background='$blockcolor'> %s </span>\
<span foreground='$txtcolor' background='$blockcolor'>-</span>\
<span foreground='$color6' background='$blockcolor'> %s </span>\
<span foreground='$color0' background='$blockcolor'></span>\n" \
"$icon $artist" "$title"
fi
