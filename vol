#!/bin/sh
# shellcheck disable=1090,2154

. "${XDG_CACHE_HOME-$HOME/.cache}/wal/colors.sh"
blockcolor=$color1
txtcolor=$color0

case $BLOCK_BUTTON in
    1) # Left Click
        $TERMINAL --class float -e ncpamixer
        ;;
    2) # Middle Click
        pamixer --toggle-mute
        ;;
    3) # Right Click
        systemctl --user restart pipewire pipewire-pulse pipewire-media-session
        ;;
    4) # Scroll Up
        pamixer -i 5
        ;;
    5) # Scroll Down
        pamixer -d 5
        ;;
    8) # Backward Button
        ;;
    9) # Forward Button
        ;;
esac

vol=$(pamixer --get-volume)

if pamixer --get-mute >/dev/null; then
    icon=""
elif [ "$vol" -lt 30 ]; then
    icon=""
elif [ "$vol" -lt 70 ]; then
    icon=""
else
    icon=""
fi

output_device=$(
	pactl list sinks |
	grep -A1 "$(
		pactl info |
		awk '/Default Sink/{print $3}'
	)" | grep "Description" | tr ' ' '\n' | tail -n1
)

printf "<b><span foreground='%s' background='%s'></span>" \
	"$blockcolor" "$color0"
printf "<span foreground='%s' background='%s'> %s </span>" \
	"$txtcolor" "$blockcolor" "$icon $output_device - $vol%"
printf "<span foreground='%s' background='%s'></span></b>\n" \
	"$color0" "$blockcolor"
