#!/bin/sh
# shellcheck disable=1090,2154

. "${XDG_CACHE_HOME-$HOME/.cache}/wal/colors.sh"
blockcolor=$color1
txtcolor=$color0

case $BLOCK_BUTTON in
    1) # Left Click
        alacritty --class float -e ncpamixer
        ;;
    2) # Middle Click
        pamixer --toggle-mute
        ;;
    3) # Right Click
        pulseaudio -k
        ;;
    4) # Scroll Up
        pamixer -i 5
        ;;
    5) # Scroll Down
        pamixer -d 5
        ;;
    8) # Backward Button
        ;;
    9) # Forward Button
        ;;
esac

vol=$(pamixer --get-volume)

if pamixer --get-mute >/dev/null; then
    icon=""
elif [ "$vol" -lt 30 ]; then
    icon=""
elif [ "$vol" -lt 70 ]; then
    icon=""
else
    icon=""
fi

output_device=$(
	pactl list sinks |
	grep -A1 "$(
		pactl info |
		awk '/Default Sink/{print $3}'
	)" |
	grep "Description" | tr ' ' '\n' | tail -n1
)

printf "\
<b><span foreground='$blockcolor' background='$color0'></span>\
<span foreground='$txtcolor' background='$blockcolor'> %s </span>\
<span foreground='$color0' background='$blockcolor'></span></b>\n" \
"$icon $output_device - $vol%"
